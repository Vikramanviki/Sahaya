<!DOCTYPE html>
<html>
<head>
    <title>Sahaya</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

<div class="container">

<h1>Sahaya</h1>
<p>Accessible Government Scheme Finder</p>

<label>Income:</label><br>
<input id="income" type="number">
<button onclick="startVoiceInput()" style="width:50px;">ЁЯОд</button>
<br><br>

<label>Disability:</label><br>
<select id="disability">
<option value="no">No</option>
<option value="yes">Yes</option>
</select><br>

<label>Education:</label><br>
<select id="education">
<option value="any">Any</option>
<option value="student">Student</option>
</select><br>

<label>Location:</label><br>
<select id="location">
<option value="any">Any</option>
<option value="rural">Rural</option>
</select><br>

<label>Language:</label><br>
<select id="language">
<option value="en-IN">English</option>
<option value="ta-IN">Tamil</option>
<option value="hi-IN">Hindi</option>
</select>


<button onclick="findSchemes()">Find Schemes</button>

<h3>Results:</h3>

<div id="loading" style="display:none; margin-top:15px;">
    <p>ЁЯФД Finding best schemes for you...</p>
</div>

<div id="result"></div>


</div>

<script>

function findSchemes() {

    document.getElementById("result").innerHTML = "";
    document.getElementById("loading").style.display = "block";

    fetch("/recommend", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            income: document.getElementById("income").value,
            disability: document.getElementById("disability").value,
            education: document.getElementById("education").value,
            location: document.getElementById("location").value
        })
    })
    .then(response => response.json())
  .then(data => {

    document.getElementById("loading").style.display = "none";

    let resultDiv = document.getElementById("result");

    if (data.length === 0) {
        resultDiv.innerHTML = "<p>No matching schemes found.</p>";
        speakText("No matching schemes found.");
        return;
    }

    data.forEach(function(scheme) {
        resultDiv.innerHTML += `
            <div class="result-card">
                <h4>${scheme.name}</h4>
                <p>${scheme.description}</p>
                <a href="${scheme.apply_link}" target="_blank">
                    <button style="margin-top:8px;">Apply Now</button>
                </a>
            </div>
        `;
    });

    // ЁЯФ┤ THIS LINE MUST EXIST
   let names = data.map(s => s.name);
let selectedLanguage = document.getElementById("language").value;
let speechText = "";

if (selectedLanguage === "ta-IN") {

    if (names.length === 1) {
        speechText = "роЙроЩрпНроХро│рпБроХрпНроХрпБ родроХрпБродро┐ропро╛рой родро┐роЯрпНроЯроорпН " + names[0];
    }
    else if (names.length === 2) {
        speechText = "роЙроЩрпНроХро│рпБроХрпНроХрпБ родроХрпБродро┐ропро╛рой родро┐роЯрпНроЯроЩрпНроХро│рпН " + names[0] + " рооро▒рпНро▒рпБроорпН " + names[1];
    }
    else {
        let last = names[names.length - 1];
        let rest = names.slice(0, -1);
        speechText = "роЙроЩрпНроХро│рпБроХрпНроХрпБ родроХрпБродро┐ропро╛рой родро┐роЯрпНроЯроЩрпНроХро│рпН " + rest.join(", ") + " рооро▒рпНро▒рпБроорпН " + last;
    }

}
else if (selectedLanguage === "hi-IN") {

    if (names.length === 1) {
        speechText = "рдЖрдк рдЗрд╕ рдпреЛрдЬрдирд╛ рдХреЗ рд▓рд┐рдП рдкрд╛рддреНрд░ рд╣реИрдВ: " + names[0];
    }
    else if (names.length === 2) {
        speechText = "рдЖрдк рдЗрди рдпреЛрдЬрдирд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдкрд╛рддреНрд░ рд╣реИрдВ: " + names[0] + " рдФрд░ " + names[1];
    }
    else {
        let last = names[names.length - 1];
        let rest = names.slice(0, -1);
        speechText = "рдЖрдк рдЗрди рдпреЛрдЬрдирд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдкрд╛рддреНрд░ рд╣реИрдВ: " + rest.join(", ") + " рдФрд░ " + last;
    }

}
else {

    if (names.length === 1) {
        speechText = "You are eligible for " + names[0];
    }
    else if (names.length === 2) {
        speechText = "You are eligible for " + names[0] + " and " + names[1];
    }
    else {
        let last = names[names.length - 1];
        let rest = names.slice(0, -1);
        speechText = "You are eligible for " + rest.join(", ") + ", and " + last;
    }

}

speakText(speechText);

});

}


function speakText(text) {

    window.speechSynthesis.cancel();

    let selectedLanguage = document.getElementById("language").value;

    let speech = new SpeechSynthesisUtterance(text);
    speech.rate = 1;
    speech.pitch = 1;

    let voices = window.speechSynthesis.getVoices();

    for (let i = 0; i < voices.length; i++) {
        if (voices[i].lang === selectedLanguage) {
            speech.voice = voices[i];
            speech.lang = selectedLanguage;
            break;
        }
    }

    window.speechSynthesis.speak(speech);
}



function startVoiceInput() {

    if (!('webkitSpeechRecognition' in window)) {
        alert("Speech Recognition not supported.");
        return;
    }

    let recognition = new webkitSpeechRecognition();
    recognition.lang = "en-IN";
    recognition.start();

    recognition.onresult = function(event) {
        let speechResult = event.results[0][0].transcript;
        let numbers = speechResult.replace(/\D/g, '');
        document.getElementById("income").value = numbers;
    };
}

</script>

</body>
</html>
